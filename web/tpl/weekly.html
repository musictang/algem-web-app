<!DOCTYPE html>
<!--
 * @(#) weekly.html Algem Web App 1.2.0 02/04/16
 *
 * Copyright (c) 2015-2016 Musiques Tangentes. All Rights Reserved.
 *
 * This file is part of Algem Web App.
 * Algem Web App is free software: you can redistribute it and/or modify it
 * under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Algem Web App is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Algem Web App. If not, see <http://www.gnu.org/licenses/>.
-->
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
  <head>
    <title th:text="${@organization['name.label']}"></title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link th:replace="fragments/styles :: common" />
    <link rel="stylesheet" th:href="@{/resources/themes/css/planning.css}" />
    <link rel="stylesheet" th:href="@{/resources/themes/css/custom.css}" />
    <link rel="stylesheet" th:href="@{/resources/themes/css/weekly.css}" />

    <script type="text/javascript" th:src="@{/resources/js/jquery-1.9.0.min.js}"></script>
    <script type="text/javascript" th:src="@{/resources/js/jquery-ui-1.11.4.min.js}"></script>
    <script type="text/javascript" th:src="@{/resources/js/common.js}"></script>
    <script type="text/javascript" th:src="@{/resources/js/planning.js}"></script>
    <script type="text/javascript" th:inline="javascript">
      var h = /*[[${timeOffset}]]*/ '720';
      
      $(function () {
        setCommonEvents();
        $("#canvas, #grid, .schedule_col").css("height", (1440 - h) +'px');
        $("footer").css("top", (1442 - h) +'px');
      });
    </script>
    </head>
  <body>
    <!--<div id="dialog">Texte du dialogue</div>-->
    <div id="bars" title="Menu"><i class="fa fa-bars"></i></div>
    <div class="closeable" id="menu">
      <ul>
        <li><a href="#" class="close-link" th:title="#{close.label}"><i class="fa fa-close"></i></a></li>
        <li><a th:href="@{/index.html}" th:title="#{home.label}"><i class="fa fa-home"></i></a></li>
        <li th:replace="fragments/menu :: cnx"></li>
      </ul>
    </div>
    <section id="login-panel" class="closeable" th:include="fragments/user :: login"></section>
    <header>
      <nav>
        <div id="date-panel"><span id="week" th:text="|s.${w}|"></span>
          <a th:href="@{/perso/weekly.html(d=${#dates.format(prevDate,'dd-MM-yyyy')},id=${param.id[0]})}" title="Semaine précédente" id="previous" tabindex="2"><i class="fa fa-chevron-circle-left"></i></a>&nbsp;&nbsp;<input id="from" type="text" class="week-date" readonly="readonly" tabindex="3" th:value="${#dates.format(start,'dd-MM-yyyy')}"/>&nbsp;<label for="to">au</label>&nbsp;<input id="to" type="text" class="week-date" readonly="readonly" tabindex="4" th:value="${#dates.format(end,'dd-MM-yyyy')}"/>&nbsp;&nbsp;<a th:href="@{/perso/weekly.html(d=${#dates.format(nextDate,'dd-MM-yyyy')},id=${param.id[0]})}" title="Semaine suivante" id="next" tabindex="1"><i class="fa fa-chevron-circle-right"></i></a>
        </div>
      </nav>
      </header>
    <table id="grid"><!-- important : loop on one line -->
      <tr th:each="half,dv : ${#numbers.sequence(timeOffset, 1410, 30)}" >
        <th>
          <p th:utext="(${timeOffset%60 == 0} ? ((${half < 600} ? '0' + ${half/60} : ${half/60}) + ':' + (${dv.odd} ? '00':'30')) :
             ((${half < 600} ? '0' + ${half/60} : ${half/60}) + ':' + (${dv.odd} ? '30':'00')))"></p>
        </th>
        <td></td>
      </tr>
    </table>
    <section id="canvas" th:with="totalTime=${1440 - timeOffset}">
      <div th:id="${entry.key}" th:each="entry,iterStat : ${planning}" class="schedule_col schedule_col_w">
        <p class="title_col" th:text="${#strings.toUpperCase(weekDays[iterStat.index < 6 ? iterStat.index +2 :1])}"></p>
        <!--Schedules-->
        <!--th:with="pos=${(p.minutes - timeOffset) * 100.0 / totalTime},h=${(p.length - 1) * 100.0 / totalTime}"-->
        <div th:each="p : ${entry.value}"
             th:class="'schedule' + ${p.label == null ? ' closed' :''}"
             th:with="pos=${p.minutes - timeOffset},h=${p.length}"
             th:style="'top:'+${pos}+'px;height:'+${h}+'px;background-color:'+${p.htmlColor}"
             th:utext="|<span class='course_label'>${#strings.replace(p.label, '<br />', ' ')}</span>Salle ${p.detail['room']}<br />${p.detail['person'] ?: ''}|"
             ></div>
      </div>
    </section>
    <footer th:replace="fragments/layout :: footer"></footer>
    <div id="errorDialog" title="Avertissement"></div>
  </body>
</html>

